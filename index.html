<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    
    <title>R&C GOLD PRO üëë - Premium Edition</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/mpegts.js@latest/dist/mpegts.min.js"></script>

    <style>
        :root { --bg: #000000; --gold: #FFD700; --card-bg: #1a1a1a; --focus-bg: #FFD700; }
        
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; }
        input { -webkit-touch-callout: default; -webkit-user-select: auto; user-select: auto; }
        
        html, body { background-color: var(--bg); color: #fff; font-family: 'Montserrat', sans-serif; position: fixed; top: 0; left: 0; width: 100vw; height: 100%; overflow: hidden !important; }

        .hide { display: none !important; }
        .flex-center { display: flex; align-items: center; justify-content: center; }
        .layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; background: #000; }

        button, .smart-card, .cat-item, .item, .power-btn, .key, .toggle-btn { cursor: pointer; }
        .cat-list, .item-list, .vid-box, video { transform: translateZ(0); will-change: transform; }

        .focused { border: 3px solid #fff !important; background: var(--focus-bg) !important; color: #000 !important; z-index: 50; box-shadow: none !important; }
        #vid-box.focused { border: 4px solid var(--gold) !important; box-shadow: none !important; z-index: 60; }
        #vid-box.fs, #vid-box.fs.focused { border: none !important; box-shadow: none !important; position: fixed !important; top: 0 !important; left: 0 !important; width: 100vw !important; height: 100% !important; z-index: 9999 !important; background: #000; }
        .focused i, .focused span, .focused div { color: #000 !important; }

        /* --- COROA PREMIUM ANIMADA --- */
        @keyframes crownPulse {
            0% { transform: scale(1) rotate(-25deg); text-shadow: 0 0 8px rgba(255, 215, 0, 0.4); }
            50% { transform: scale(1.15) rotate(-20deg); text-shadow: 0 0 18px rgba(255, 215, 0, 1); }
            100% { transform: scale(1) rotate(-25deg); text-shadow: 0 0 8px rgba(255, 215, 0, 0.4); }
        }
        .logo-wrapper { position: relative; display: inline-block; margin-right: 2px; }
        .logo-wrapper i.fa-crown { position: absolute; top: -8px; left: -16px; font-size: 17px; color: var(--gold); animation: crownPulse 2.5s infinite ease-in-out; z-index: 2; }

        .login-box { width: 450px; max-width: 90%; padding: 30px; background: #111; border: 1px solid #333; border-radius: 12px; text-align: center; }
        .logo-txt { font-size: 28px; font-weight: 900; letter-spacing: -1px; color:#fff; margin-bottom: 20px; text-transform: uppercase; }
        .logo-txt span.gold-text { color: var(--gold); }
        .inp { width: 100%; padding: 12px; margin: 8px 0; background: #222; border: 1px solid #444; color: #fff; text-align: center; font-weight: bold; border-radius: 6px; }
        .config-row { display: flex; gap: 10px; margin: 10px 0; }
        .toggle-btn { flex: 1; padding: 10px; background: #1a1a1a; border: 1px solid #444; color: #888; font-size: 11px; font-weight: 800; text-transform: uppercase; border-radius: 6px; transition: none; }
        .toggle-btn.active { border-color: var(--gold); color: var(--gold); background: #222; }
        .btn { width: 100%; padding: 12px; margin-top: 15px; background: var(--gold); color: #000; border: none; cursor: pointer; text-transform: uppercase; font-weight: 900; border-radius: 6px; }
        .info-row { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #222; font-size: 13px; color: #ccc; }
        .info-row span { font-weight: bold; color: var(--gold); }

        #dash-layer { display: flex; flex-direction: column; padding: 25px 40px; justify-content: flex-start; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; height: 60px; flex-shrink: 0; margin-bottom: 15px; }
        .dash-logo { font-size: 32px; font-weight: 900; letter-spacing: -1px; }
        .dash-logo span.gold-text { color: var(--gold); }
        .dash-clock { text-align: center; }
        .clock-time { font-size: 24px; font-weight: 700; color: #fff; }
        .clock-date { font-size: 12px; color: #888; text-transform: uppercase; font-weight: 600; margin-top: 5px; }
        .top-actions { display: flex; gap: 10px; align-items: center; }
        .power-btn { width: 50px; height: 50px; font-size: 22px; color: #666; border-radius: 50%; border: 2px solid transparent; display: flex; align-items: center; justify-content: center; }
        .dash-grid { display: flex; gap: 20px; justify-content: center; align-items: center; flex: 1; flex-wrap: wrap; flex-shrink: 0; margin-bottom: 20px; }
        
        .smart-card { width: 190px; height: 210px; background: var(--card-bg); border: 2px solid #333; border-radius: 16px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .smart-card i { font-size: 55px; margin-bottom: 15px; color: #555; }
        .smart-card span { font-size: 16px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; color: #ccc; }
        
        .bottom-bar { display: flex; justify-content: space-between; align-items: flex-end; flex-shrink: 0; margin-top: auto; padding-bottom: 10px; }
        .info-pill { background: rgba(255, 255, 255, 0.05); padding: 8px 20px; border-radius: 30px; border: 1px solid #333; }
        .lbl { font-size: 10px; color: #888; font-weight: 700; text-transform: uppercase; display: block; margin-bottom: 2px; }
        .val { font-size: 14px; color: var(--gold); font-weight: 800; }

        #content-layer { display: flex; position: relative; }
        .col-cat { width: 25%; background: #0b0b0b; border-right: 1px solid #222; display: flex; flex-direction: column; height: 100%; }
        .cat-head { padding: 12px; background: #111; color: var(--gold); font-weight: 900; border-bottom: 2px solid var(--gold); display: flex; align-items: center; justify-content: space-between; font-size: 14px; }
        .btn-voltar { background: rgba(255, 255, 255, 0.1); width: 32px; height: 32px; border-radius: 50%; border: 1px solid #333; color: var(--gold); font-size: 14px; font-weight: bold; display: flex; align-items: center; justify-content: center; }
        .btn-voltar:active { background: var(--gold); color: #000; border-color: var(--gold); }
        .cat-title-spacer { width: 32px; } 
        .cat-list { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .cat-item { padding: 12px 20px; border-bottom: 1px solid #1a1a1a; color: #999; font-size: 13px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; touch-action: pan-y; }
        .cat-item.active { border-left: 5px solid var(--gold); background: #181818; color: #fff; }

        .col-list { width: 35%; background: #111; border-right: 1px solid #222; display: flex; flex-direction: column; height: 100%; }
        .search-area { padding: 12px; background: #080808; border-bottom: 1px solid #333; display: flex; align-items: center; }
        .inp-search { width: 100%; background: #222; border: 1px solid #333; color: #fff; padding: 10px; text-align: center; font-weight: bold; border-radius: 6px; text-transform: uppercase; font-size: 13px; }
        .item-list { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .item { padding: 12px 20px; border-bottom: 1px solid #1a1a1a; color: #bbb; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; touch-action: pan-y; }
        .item.playing { color: var(--gold); font-weight: bold; background: #181818; border-left: 3px solid var(--gold); }
        .fav-icon { float: right; color: var(--gold); margin-left: 10px; }

        .col-play { flex: 1; background: #000; display: flex; flex-direction: column; position: relative; height: 100%; }
        .vid-box { width: 100%; height: 50vh; background: #000; position: relative; border-bottom: 2px solid #333; cursor: pointer; overflow: hidden; }
        video { width: 100%; height: 100%; background: #000; object-fit: fill !important; position: absolute; top: 0; left: 0; }
        
        .meta { padding: 20px; flex: 1; background: #080808; display: flex; flex-direction: column; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .meta-title { font-size: 20px; color: var(--gold); font-weight: 800; margin-bottom: 8px; display: flex; align-items: center; }
        .meta-epg { font-size: 12px; background: #222; color: #fff; padding: 4px 8px; border-radius: 4px; display: inline-block; margin-bottom: 12px; align-self: flex-start; }
        .meta-desc { font-size: 13px; color: #777; line-height: 1.4; margin-bottom: 15px; }
        .keys { display: flex; gap: 15px; margin-top: auto; padding-top: 15px; border-top: 1px solid #222; flex-wrap: wrap; }
        .key { font-size: 11px; font-weight: bold; color: #aaa; text-transform: uppercase; display: flex; align-items: center; gap: 6px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; }

        #loader { background: rgba(0,0,0,0.95); z-index: 20000; flex-direction: column; color: var(--gold); font-weight: 900; }
        .osd-status { position: absolute; top: 20px; right: 20px; background: rgba(0,0,0,0.8); color: var(--gold) !important; padding: 10px 20px; border-radius: 6px; font-size: 14px; font-weight: 900; display: none; z-index: 10000; pointer-events: none; letter-spacing: 1px; text-transform: uppercase; }
        ::-webkit-scrollbar { width: 4px; height: 4px; } ::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }
    </style>
</head>
<body onload="App.init()">

    <div id="loader" class="hide flex-center">
        <i class="fas fa-circle-notch fa-spin" style="font-size:40px; margin-bottom:15px"></i>
        <div id="load-txt">CARREGANDO...</div>
    </div>

    <div id="login-layer" class="layer flex-center hide">
        <div class="login-box">
            <div class="logo-txt">R&C <span class="gold-text">GOLD PRO</span></div>
            <input type="text" id="i0" class="inp focusable" placeholder="URL DNS" autocomplete="off">
            <input type="text" id="i1" class="inp focusable" placeholder="USU√ÅRIO" autocomplete="off">
            <input type="password" id="i2" class="inp focusable" placeholder="SENHA" autocomplete="off">
            <button id="i3" class="btn focusable" onclick="App.login(false)">CONECTAR</button>
            <div id="msg-login" style="color:red; margin-top:10px; font-size:12px;"></div>
        </div>
    </div>

    <div id="settings-layer" class="layer hide flex-center">
        <div class="login-box" style="width: 500px;">
            <div class="logo-txt"><i class="fas fa-user-cog" style="margin-right:8px;"></i>MINHA <span class="gold-text">CONTA</span></div>
            <div class="info-row">NOME: <span id="set-user">...</span></div>
            <div class="info-row">VENCIMENTO: <span id="set-exp">...</span></div>
            <div class="info-row">TELAS: <span id="set-conn">...</span></div>
            <div class="config-row" style="margin-top: 20px;"><div id="s0" class="toggle-btn focusable" style="border-color: #333; background: #111; cursor: default;">--- OP√á√ïES ---</div></div>
            <div class="config-row">
                <div id="s1" class="toggle-btn focusable" onclick="App.toggleCfg('filter')">PORN BLOCK: <span id="lbl-filter" style="color:#fff">SIM</span></div>
                <div id="s2" class="toggle-btn focusable" onclick="App.toggleFormat()">FORMATO TV: <span id="lbl-format" style="color:#fff">PADR√ÉO</span></div>
            </div>
            <button id="s3" class="btn focusable" onclick="App.closeSettings()" style="background: #333; color: #fff;">VOLTAR</button>
        </div>
    </div>

    <div id="dash-layer" class="layer hide">
        <div class="top-bar">
            <div class="dash-logo"><span class="logo-wrapper"><i class="fas fa-crown"></i>R</span>&C <span class="gold-text">GOLD PRO</span></div>
            <div class="dash-clock"><div id="clock-time" class="clock-time">12:00</div><div id="clock-date" class="clock-date">--/--/----</div></div>
            <div class="top-actions">
                <div id="m3" class="power-btn focusable" onclick="App.openSettings()"><i class="fas fa-cog"></i></div>
                <div id="m4" class="power-btn focusable" onclick="App.logout()"><i class="fas fa-power-off"></i></div>
            </div>
        </div>
        <div class="dash-grid">
            <div id="m0" class="smart-card focusable" role="button" tabindex="-1" onclick="App.openMode('live')"><i class="fas fa-tv"></i><span>TV AO VIVO</span></div>
            <div id="m1" class="smart-card focusable" role="button" tabindex="-1" onclick="App.openMode('movie')"><i class="fas fa-film"></i><span>FILMES</span></div>
            <div id="m2" class="smart-card focusable" role="button" tabindex="-1" onclick="App.openMode('series')"><i class="fas fa-video"></i><span>S√âRIES</span></div>
        </div>
        <div class="bottom-bar">
            <div class="info-pill"><span class="lbl">VENCIMENTO</span><span id="info-exp" class="val">...</span></div>
            <div class="info-pill" style="text-align: right;"><span class="lbl">TELAS</span><span id="info-conn" class="val">...</span></div>
        </div>
    </div>

    <div id="content-layer" class="layer hide">
        <div class="col-cat">
            <div class="cat-head">
                <div id="btn-back" class="btn-voltar hide" onclick="App.back()"><i class="fas fa-arrow-left"></i></div>
                <div style="flex:1; text-align:center;">CATEGORIAS</div>
                <div class="cat-title-spacer"></div>
            </div>
            <div id="cat-list" class="cat-list"></div>
        </div>
        <div class="col-list">
            <div class="search-area"><input type="text" id="search" class="inp-search focusable" placeholder="PESQUISAR..." autocomplete="off"></div>
            <div id="item-list" class="item-list"></div>
        </div>
        <div class="col-play">
            <div id="vid-box" class="vid-box focusable" onclick="App.handleVideoTap(event)">
                <video id="player" playsinline webkit-playsinline></video>
                <div id="osd" class="osd-status"></div>
            </div>
            <div class="meta">
                <div id="meta-title" class="meta-title">R&C GOLD PRO</div>
                <div id="meta-epg" class="meta-epg hide"></div>
                <div id="meta-desc" class="meta-desc"></div>
            </div>
        </div>
    </div>

    <script>
        function requestNativeFullscreen(elem) { var target = elem || document.documentElement; try { if (target.requestFullscreen) { target.requestFullscreen({ navigationUI: 'hide' }).catch(function(){}); } else if (target.webkitRequestFullscreen) { target.webkitRequestFullscreen(); } } catch (e) {} try { if(screen.orientation && screen.orientation.lock) { screen.orientation.lock('landscape').catch(function(){}); } } catch(e) {} }

        var FavManager = {
            key: 'rc_favs_smart', list: [],
            init: function() { var s = localStorage.getItem(this.key); this.list = s ? JSON.parse(s) : []; },
            toggle: function(id) { var idx = this.list.indexOf(id); if(idx > -1) this.list.splice(idx, 1); else this.list.push(id); localStorage.setItem(this.key, JSON.stringify(this.list)); if(App.idx < App.fullData.length) App.renderList(true); },
            isFav: function(id) { return this.list.indexOf(id) > -1; }
        };

        var PlayerEngine = {
            hls: null, tsPlayer: null, video: null, url: null, retryCount: 0,
            init: function() { 
                this.video = document.getElementById('player'); 
                this.video.onended = function() { 
                    if (App.mode === 'live') { PlayerEngine.recover(); } 
                    else if (App.mode === 'series' && App.isFolder && App.idx < App.seriesEps.length-1) { App.idx++; App.updateFocus(); App.playStream(App.seriesEps[App.idx]); } 
                    else { App.exitFull(); } 
                };
            },
            play: function(url, isLive) {
                if(this.url === url && !this.video.paused) return;
                this.stop(); this.url = url; this.retryCount = 0; this.video.controls = false;
                
                if (url.indexOf('.ts') > -1) {
                    if (typeof mpegts !== 'undefined' && mpegts.getFeatureList().mseLivePlayback) {
                        // OTIMIZA√á√ÉO MAXIMA DE MEM√ìRIA PARA TV
                        this.tsPlayer = mpegts.createPlayer({ type: 'mse', isLive: isLive, url: url }, {
                            enableWorker: false, 
                            enableStashBuffer: false, // Desliga cache extra que explode a RAM
                            liveBufferLatencyChasing: true, // For√ßa n√£o acumular atraso
                            lazyLoad: false, autoCleanupSourceBuffer: true, autoCleanupMaxBackwardDuration: 2, autoCleanupMinBackwardDuration: 1
                        });
                        this.tsPlayer.attachMediaElement(this.video); this.tsPlayer.load(); this.tsPlayer.play().catch(function(){});
                        this.tsPlayer.on(mpegts.Events.ERROR, function() { PlayerEngine.recover(); });
                    } else { this.video.src = url; this.video.play().catch(function(){}); }
                } else if (url.indexOf('.m3u8') > -1) {
                    if (Hls.isSupported()) { this.startHls(url); } 
                    else { this.video.src = url; this.video.play().catch(function(){}); }
                } else { this.video.src = url; this.video.play().catch(function(){}); }
            },
            startHls: function(url) {
                if(this.hls) { this.hls.destroy(); }
                // OTIMIZA√á√ÉO MAXIMA DE MEM√ìRIA PARA HLS
                this.hls = new Hls({ enableWorker: false, maxBufferLength: 5, maxMaxBufferLength: 10, liveSyncDurationCount: 2 }); 
                this.hls.loadSource(url); this.hls.attachMedia(this.video);
                this.hls.on(Hls.Events.MANIFEST_PARSED, function() { PlayerEngine.video.play().catch(function(){}); });
                this.hls.on(Hls.Events.ERROR, function(e, data) { if (data.fatal) { PlayerEngine.recover(); } });
            },
            recover: function() {
                this.retryCount++; if(this.retryCount > 5 && App.mode !== 'live') { this.stop(); return; }
                App.osd("RECONECTANDO..."); setTimeout(function(){ if(PlayerEngine.url) PlayerEngine.play(PlayerEngine.url, App.mode === 'live'); }, 3000);
            },
            stop: function() { 
                this.url = null; this.video.onerror = null; 
                if(this.hls) { this.hls.destroy(); this.hls = null; } 
                if(this.tsPlayer) { this.tsPlayer.destroy(); this.tsPlayer = null; }
                if(this.video) { this.video.pause(); this.video.removeAttribute('src'); this.video.load(); } 
            }
        };

        var App = {
            scr: 0, zone: 0, idx: 0, lastCatIdx: 0, creds: {}, fullData: [], storedList: [], memIdx: 0, globalData: null, isFolder: false, seriesEps: [], playingId: null, cfg: { filter: true, format: 'default' }, renderLimit: 30, // Reduzido para poupar RAM

            init: function() {
                FavManager.init(); if(localStorage.getItem('rc_cfg_filter')) this.cfg.filter = (localStorage.getItem('rc_cfg_filter') === 'true'); if(localStorage.getItem('rc_cfg_format')) this.cfg.format = localStorage.getItem('rc_cfg_format');
                this.updateCfgUI(); PlayerEngine.init(); setInterval(this.updateClock, 1000); this.updateClock();
                if(localStorage.getItem('rc_h')) { document.getElementById('i0').value = localStorage.getItem('rc_h'); document.getElementById('i1').value = localStorage.getItem('rc_u'); document.getElementById('i2').value = localStorage.getItem('rc_p'); App.login(true); } else { this.setScr(0); }
            },
            toggleCfg: function(type) { if(type === 'filter') { this.cfg.filter = !this.cfg.filter; localStorage.setItem('rc_cfg_filter', this.cfg.filter); } this.updateCfgUI(); },
            toggleFormat: function() { if (this.cfg.format === 'default') this.cfg.format = 'hls'; else if (this.cfg.format === 'hls') this.cfg.format = 'ts'; else this.cfg.format = 'default'; localStorage.setItem('rc_cfg_format', this.cfg.format); this.updateCfgUI(); },
            updateCfgUI: function() { document.getElementById('lbl-filter').innerText = this.cfg.filter ? "SIM" : "N√ÉO"; document.getElementById('lbl-format').innerText = this.cfg.format === 'hls' ? "HLS (.m3u8)" : (this.cfg.format === 'ts' ? "TS (.ts)" : "PADR√ÉO"); },
            updateClock: function() { var now = new Date(); var m = now.getMinutes(); if(m<10) m='0'+m; document.getElementById('clock-time').innerText = now.getHours() + ":" + m; },
            req: function(url, cb) { var x = new XMLHttpRequest(); x.open("GET", url, true); x.timeout = 15000; x.onload = function() { if(x.status===200) { try{cb(JSON.parse(x.responseText));}catch(e){cb(null);} } else cb(null); }; x.onerror = function(){ cb('ERR_NET'); }; x.send(); },

            login: function(isAuto) {
                var h = document.getElementById('i0').value.trim(); var u = document.getElementById('i1').value.trim(); var p = document.getElementById('i2').value.trim(); if(h.endsWith('/')) h = h.slice(0, -1); if(h.indexOf('http') === -1) h = 'http://' + h;
                if(!isAuto) { document.getElementById('loader').classList.remove('hide'); }
                this.req(h+"/player_api.php?username="+u+"&password="+p, function(d){
                    document.getElementById('loader').classList.add('hide');
                    if(d === 'ERR_NET') { if(!isAuto) document.getElementById('msg-login').innerHTML = "Falha de Conex√£o!"; return; }
                    if(d && d.user_info && d.user_info.auth==1) { App.creds={h:h,u:u,p:p}; localStorage.setItem('rc_h', h); localStorage.setItem('rc_u', u); localStorage.setItem('rc_p', p); App.setScr(1); } else { App.setScr(0); document.getElementById('msg-login').innerText="Inv√°lido"; localStorage.clear(); }
                });
            },
            logout: function() { localStorage.clear(); location.reload(); },
            setScr: function(n) {
                if(n===1) { PlayerEngine.stop(); this.fullData = []; this.globalData = null; } // Zera cache ao voltar
                document.querySelectorAll('.layer').forEach(function(l){l.classList.add('hide')});
                if(n===0) document.getElementById('login-layer').classList.remove('hide'); if(n===1) document.getElementById('dash-layer').classList.remove('hide');
                if(n===2) { document.getElementById('content-layer').classList.remove('hide'); document.getElementById('btn-back').classList.remove('hide'); this.renderLimit = 30; } else { var btn = document.getElementById('btn-back'); if(btn) btn.classList.add('hide'); }
                if(n===3) document.getElementById('settings-layer').classList.remove('hide'); this.scr=n; this.zone=0; this.idx=0; this.updateFocus();
            },
            openSettings: function() { this.setScr(3); this.idx = 0; this.updateFocus(); }, closeSettings: function() { this.setScr(1); this.idx=3; this.updateFocus(); },

            openMode: function(m) {
                PlayerEngine.stop(); this.resetInfo(); this.mode = m; this.setScr(2); document.getElementById('cat-list').innerHTML = ''; document.getElementById('item-list').innerHTML = '';
                var act = (m==='live')?'get_live_categories':(m==='movie'?'get_vod_categories':'get_series_categories');
                this.req(this.creds.h+"/player_api.php?username="+this.creds.u+"&password="+this.creds.p+"&action="+act, function(d){
                    if(d && d!=='ERR_NET') {
                        var h = '<div class="cat-item" role="button" tabindex="-1" id="c0" data-id="fav" onclick="App.catClick(0)">‚≠ê FAVORITOS</div>'; var count = 0;
                        for(var i=0;i<d.length;i++) { h += '<div class="cat-item" role="button" tabindex="-1" id="c'+(++count)+'" data-id="'+d[i].category_id+'" onclick="App.catClick('+count+')">'+d[i].category_name+'</div>'; }
                        document.getElementById('cat-list').innerHTML = h; App.zone=0; App.idx=0; App.updateFocus();
                    }
                });
            },
            resetInfo: function() { document.getElementById('meta-title').innerHTML = 'R&C GOLD PRO'; document.getElementById('meta-desc').innerText = ""; document.getElementById('meta-epg').classList.add('hide'); },
            catClick: function(i) { this.idx=i; this.zone=0; this.renderLimit=30; this.loadContent(i); },

            loadContent: function(catIdx) {
                this.lastCatIdx = catIdx; var el = document.getElementById('c'+catIdx); if(!el) return; var cid = el.getAttribute('data-id');
                document.querySelectorAll('.cat-item').forEach(function(e){e.classList.remove('active')}); el.classList.add('active');
                document.getElementById('item-list').innerHTML = ''; // Zera lista imediatamente
                var actStr = (this.mode==='live')?'get_live_streams':(this.mode==='movie'?'get_vod_streams':'get_series');
                var url = this.creds.h+"/player_api.php?username="+this.creds.u+"&password="+this.creds.p+"&action="+actStr + (cid==='fav' ? '' : '&category_id='+cid);
                this.req(url, function(d) { if(d && d!=='ERR_NET') { App.fullData = cid==='fav' ? d.filter(function(x){ return FavManager.isFav(x.stream_id || x.series_id); }) : d; App.isFolder = false; App.renderList(); } });
            },

            renderList: function() {
                var d = this.fullData; var max = d.length; if(max===0) { document.getElementById('item-list').innerHTML = '<div style="padding:20px;">Vazio</div>'; return; }
                var limit = Math.min(max, this.renderLimit); var h = '';
                for(var i=0; i<limit; i++) { h += '<div class="item" role="button" tabindex="-1" id="row-'+i+'" onclick="App.itemClick('+i+')">'+(d[i].name || d[i].title)+'</div>'; }
                if(max > this.renderLimit) { h += '<div class="item" role="button" tabindex="-1" id="row-'+limit+'" style="color:var(--gold); font-weight:bold; text-align:center;" onclick="App.loadMore()">+ MAIS</div>'; }
                document.getElementById('item-list').innerHTML = h; this.zone = 2; this.updateFocus();
            },
            loadMore: function() { this.renderLimit += 30; this.renderList(); this.idx = this.renderLimit - 30; this.updateFocus(); },
            itemClick: function(i) { this.idx=i; this.zone=2; this.clickItem(); },
            clickItem: function() {
                if(this.idx >= this.renderLimit && this.idx === Math.min(this.fullData.length, this.renderLimit)) { this.loadMore(); return; }
                if(this.isFolder) { this.playStream(this.seriesEps[this.idx]); return; } var item = this.fullData[this.idx]; if(this.mode !== 'series') { if(item) this.playStream(item); return; }
                if(item) { this.storedList = [...this.fullData]; this.memIdx = this.idx; this.req(this.creds.h+"/player_api.php?username="+this.creds.u+"&password="+this.creds.p+"&action=get_series_info&series_id="+item.series_id, function(d){ if(d && d.episodes) { var eps = []; for(var k in d.episodes) for(var j=0; j<d.episodes[k].length; j++) eps.push(d.episodes[k][j]); App.seriesEps = eps; App.fullData = eps; App.isFolder = true; App.renderLimit=100; App.renderList(); } }); }
            },

            playStream: function(item) {
                var type = (this.mode==='live')?'live':(this.mode==='movie'?'movie':'series'); var id = item.stream_id || item.id; 
                var ext = (this.mode==='live') ? (this.cfg.format === 'ts' ? 'ts' : 'm3u8') : (item.container_extension||'mp4');
                var url = this.creds.h+"/"+type+"/"+this.creds.u+"/"+this.creds.p+"/"+id + "." + ext;
                this.playingId = id; document.getElementById('meta-title').innerText = item.name || item.title; PlayerEngine.play(url, this.mode==='live');
                document.querySelectorAll('.item').forEach(function(e){e.classList.remove('playing')}); var r = document.getElementById('row-'+this.idx); if(r) r.classList.add('playing'); 
            },

            handleVideoTap: function(e) { e.preventDefault(); if(!App.playingId) return; this.toggleFull(); },
            toggleFull: function() { if(!this.playingId) return; var b = document.getElementById('vid-box'); if(b.classList.contains('fs')) { b.classList.remove('fs'); document.exitFullscreen?.(); } else { b.classList.add('fs'); requestNativeFullscreen(b); } },
            back: function() { if(document.getElementById('vid-box').classList.contains('fs')) { this.toggleFull(); return; } if(this.zone===3) { this.zone=2; this.updateFocus(); return; } if(this.zone===2 && this.isFolder) { this.isFolder = false; this.fullData = this.storedList; this.renderLimit = 30; this.renderList(); this.idx = this.memIdx; this.updateFocus(); return; } if(this.zone===2) { this.zone=0; this.idx=this.lastCatIdx; this.updateFocus(); return; } if(this.zone===0) { this.setScr(1); return; } },
            
            updateFocus: function() { document.querySelectorAll('.focused').forEach(function(e){e.classList.remove('focused')}); var el; if(this.scr===0) el=document.getElementById('i'+this.idx); if(this.scr===1) el=document.getElementById('m'+this.idx); if(this.scr===3) el=document.getElementById('s'+this.idx); if(this.scr===2) { if(this.zone===0) el=document.getElementById('c'+this.idx); if(this.zone===1) el=document.getElementById('search'); if(this.zone===2) el=document.getElementById('row-'+this.idx); if(this.zone===3) el=document.getElementById('vid-box'); } if(el) { el.classList.add('focused'); if(el.tagName!=='INPUT') { el.focus(); var p = el.parentElement; if(p && (p.style.overflowY === 'auto' || p.classList.contains('cat-list') || p.classList.contains('item-list'))) { p.scrollTop = el.offsetTop - (p.clientHeight/2); } } } },
            move: function(d) { /* L√≥gica de Setas simplificada mantida no updateFocus para encurtar o c√≥digo */ if(this.scr===2 && this.zone===2) { if(d===1 && this.idx < this.renderLimit) this.idx++; if(d===0 && this.idx > 0) this.idx--; if(d===2) this.zone=0; } else if(this.scr===2 && this.zone===0) { if(d===1) this.idx++; if(d===0 && this.idx>0) this.idx--; if(d===3) {this.zone=2; this.idx=0;} } this.updateFocus(); },
            osd: function(t) { var o=document.getElementById('osd'); o.innerText=t; o.style.display='block'; setTimeout(function(){o.style.display='none'},2000); }
        };

        document.addEventListener('keydown', function(e) {
            var k=e.keyCode; if(k===38) { e.preventDefault(); App.move(0); } if(k===40) { e.preventDefault(); App.move(1); } if(k===37) { e.preventDefault(); App.move(2); } if(k===39) { e.preventDefault(); App.move(3); }
            if(k===13) { e.preventDefault(); if(App.scr===2 && App.zone===0) App.loadContent(App.idx); else if(App.scr===2 && App.zone===2) App.clickItem(); else if(App.scr===0) App.login(false); else if(App.scr===1) App.openMode(['live','movie','series'][App.idx]); }
            if(k===8||k===27||k===461||k===10009) { e.preventDefault(); App.back(); }
        });
    </script>
</body>
</html>
